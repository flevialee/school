<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>單堂鐘點費（雙向計算版）</title>
  <style>
    body { font-family: system-ui, "微軟正黑體", sans-serif; line-height: 1.8; padding: 24px; }
    h3 { margin-top: 0; }
    .sentence { font-size: 1.1rem; }
    .blank {
      display: inline-block;
      min-width: 8ch;
      padding: 2px 6px;
      border: none;
      border-bottom: 2px solid #333;
      outline: none;
      text-align: right;
      font: inherit;
      background: #fff;
    }
    .blank:focus { background: #fffceb; }
    .btn { margin-top: 14px; padding: 8px 12px; border: 1px solid #aaa; border-radius: 10px; background: #f7f7f7; cursor: pointer; }
    .btn:hover { background: #efefef; }
    .warn { color: #c62828; margin-top: 8px; }
    .note { color:#666; font-size:.95rem; margin-top: 6px; }
  </style>
</head>
<body>
  <h3>單堂鐘點費計算（可雙向輸入）</h3>

  <div class="sentence" aria-live="polite">
    課程費
    <input id="fee" class="blank" type="number" min="0" step="any" inputmode="decimal" placeholder="課程費" />
    × 0.8 ÷ 堂數
    <input id="classes" class="blank" type="number" min="0" step="any" inputmode="decimal" placeholder="堂數" />
    × 人數
    <input id="people" class="blank" type="number" min="0" step="1" inputmode="numeric" placeholder="人數" />
    ＝ 單堂鐘點費
    <input id="hourly" class="blank" type="number" min="0" step="any" inputmode="decimal" placeholder="自動計算或輸入" /> 元
  </div>

  <button id="clearBtn" class="btn" type="button">清除</button>
  <div id="warn" class="warn"></div>
  <div class="note">提示：輸入前面三欄會算出鐘點費；直接輸入鐘點費也能反推課程費。<br>單堂鐘點費不可超過 4000 元 / 40 分鐘</div>

  <script>
    const feeEl = document.getElementById('fee');
    const classesEl = document.getElementById('classes');
    const peopleEl = document.getElementById('people');
    const hourlyEl = document.getElementById('hourly');
    const warnEl = document.getElementById('warn');
    const clearBtn = document.getElementById('clearBtn');

    let lock = false; // 避免事件循環

    function num(el, def = 0) {
      const v = parseFloat(el.value);
      return Number.isFinite(v) ? v : def;
    }

    function computeFromFee() {
      if (lock) return;
      lock = true;

      const fee = num(feeEl, 0);
      const classes = num(classesEl, NaN);
      const people = num(peopleEl, 0);

      warnEl.textContent = '';

      if (!Number.isFinite(classes) || classes <= 0) {
        hourlyEl.value = '';
        if (classesEl.value !== '') {
          warnEl.textContent = '堂數需要大於 0，請確認輸入。';
        }
        lock = false;
        return;
      }

      const result = fee * 0.8 / classes * people;
      if (Number.isFinite(result)) {
        hourlyEl.value = result.toFixed(2);
      } else {
        hourlyEl.value = '';
      }
      lock = false;
    }

    function computeFromHourly() {
      if (lock) return;
      lock = true;

      const hourly = num(hourlyEl, 0);
      const classes = num(classesEl, NaN);
      const people = num(peopleEl, 0);

      warnEl.textContent = '';

      if (!Number.isFinite(classes) || classes <= 0 || people <= 0) {
        feeEl.value = '';
        if (classesEl.value !== '' || peopleEl.value !== '') {
          warnEl.textContent = '堂數與人數需要大於 0，才能反推課程費。';
        }
        lock = false;
        return;
      }

      const fee = (hourly / people) * classes / 0.8;
      if (Number.isFinite(fee)) {
        feeEl.value = fee.toFixed(2);
      } else {
        feeEl.value = '';
      }
      lock = false;
    }

    // 綁定事件
    [feeEl, classesEl, peopleEl].forEach(el => {
      el.addEventListener('input', computeFromFee);
    });
    hourlyEl.addEventListener('input', computeFromHourly);

    // 清除按鈕
    clearBtn.addEventListener('click', () => {
      feeEl.value = '';
      classesEl.value = '';
      peopleEl.value = '';
      hourlyEl.value = '';
      warnEl.textContent = '';
      feeEl.focus();
    });
  </script>
</body>
</html>
